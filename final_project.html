<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>Cambridge Traffic Crash Map</title>
	<script src="https://d3js.org/d3.v4.min.js">
	</script>	
	<script src="https://unpkg.com/topojson@3"></script>

</head>
<style>
</style>

<body>
	<svg id="map", width="800", height="600">
		<rect width="800", height="600" fill="white"></rect>
	</svg>
  <div id="input">
      <select id="buttonMonth">
      <option value="01">January</option>
      <option value="02">Feburary</option>
      <option value="03">March</option>
      <option value="04">April</option>
      <option value="05">May</option>
      <option value="06">June</option>
      <option value="all">All</option>
    </select> 
  </div>
</body>

<script>

	function datafold(json) {
	    return json.data.map(function(data){
	      return json.meta.view.columns.reduce(function(obj, header, i){
	        obj[header.name] = data[i];
	        return obj;
	      }, {});
	    });
	  }

    let dataSet = [];
    d3.queue()
      .defer(d3.json,"cambridge.geojson")
      .defer(d3.json, "cambridge crash data.json")
      .awaitAll(function(error,dataArray){
      	if (error) console.log(error);
      	var geoJSON = dataArray[0];
        dataSet = dataArray[1];
      	console.log(dataArray[1]);
      	var crashData = datafold(dataArray[1]).filter(function(d){
      		return d.Longitude && d.Latitude;

      	});
      	
        let m = [1, 2, 3, 4, 5, 6];

        crashData.forEach(function(d) {
          let a = new Date(d["Date Time"]);
      		d.year = a.getFullYear();
          d.month = a.getMonth();
      	});

      	console.log(crashData);

      	var years = Array.from(new Set(crashData.map(function(d) {
      		return d.year;
      	}))).sort();


        function getYear(prm){
          var check = false;
          for(var i = 0; i < years.length; i++) {
            if(years[i] == prm) {
              console.log("year: " + years[i] + " index: " + i);
              return i;
            }
          }
          return null;
        }  
      	

      	var oldestData = crashData.filter(function(d) {
          var obj = getYear(2016);
      		return d.year == years[obj];
      	});

        console.log(oldestData);

        eachMonth = oldestData.filter(function(oldestData,i){
            return oldestData * i


        })

        

        

      	var proj = d3.geoAlbersUsa()
      	             .fitSize([600,400], geoJSON);

      	var path = d3.geoPath()
      	             .projection(proj);

      	var streets = d3.select("#map").selectAll("path")
      	                  .data(geoJSON.features);
      	streets.enter().append("path")
      	       .attr("d", function(d){
      	       	return path(d);
      	       })
      	       .attr("fill","lightgrey")
      	       .attr("stroke-width",1)
      	       .attr("stroke","lightblue")


      	var circles = d3.select("#map").selectAll("circle")
      	               .data(oldestData)
                       .enter().append("circle")
                       .attr("transform", function(d){
                        return "translate(" + proj([d.Longitude,d.Latitude]) + ")";
                        })
                       .attr("fill", "red")
                       .attr("opacity", 0.25)
                       .attr("r",5);

        
         //Hello Dave, Look at here.
         // var buttons = d3.select("#buttonMonth")
         //              buttons.on("click", function(d){




                       

         // });














      











      });

</script>





</html>